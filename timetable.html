<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Timetable</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    .timetable-container, footer {
      display: none; /* hide initially */
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-name">
      <img src="assets/logo.jpeg" alt="EduNova Logo" class="logo">
      <span class="institution-name">EduNova</span>
    </div>
    <div class="nav-wrapper">
      <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About Us</a>
        <a href="courses.html">Courses</a>
        <a href="timetable.html">Timetable</a>
        <a href="contact.html">Contact</a>
        <a href="admin/login.html" class="admin-btn">Admin Login</a>
      </nav>
    </div>
  </header>

  <!-- Timetable Container -->
  <div class="timetable-container"></div>

  <footer>
    <p>&copy; 2025 EduNova Academy | All Rights Reserved</p>
    <div class="footer-middle">
      <span><i class="fas fa-map-marker-alt"></i> Embilipitiya, Sri Lanka</span> |
      <span><i class="fas fa-envelope"></i> edunovaacademy.lk@gmail.com</span> |
      <span><i class="fas fa-phone"></i> 0728561668 / 0711733650</span>
    </div>
  </footer>

  <script>
    const url = "http://localhost:5000/api/timetable";

    async function loadTimetable() {
      const container = document.querySelector(".timetable-container");
      const footer = document.querySelector("footer");

      try {
        const response = await fetch(url);
        const timetable = await response.json();

        container.innerHTML = "";

        if (!timetable.entries || timetable.entries.length === 0) {
          container.innerHTML = "<p>No timetable found.</p>";
        } else {
          const days = {};
          timetable.entries.forEach(entry => {
            if (!days[entry.day]) days[entry.day] = [];
            days[entry.day].push(entry);
          });

          const daysOfWeek = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
          const rowSize = 2;

          for (let i = 0; i < daysOfWeek.length; i += rowSize) {
            const gridRow = document.createElement("div");
            gridRow.className = "schedule-grid";

            const rowDays = daysOfWeek.slice(i, i + rowSize);
            rowDays.forEach(day => {
              if (!days[day]) return;

              const dayColumn = document.createElement("div");
              dayColumn.className = "day-column";

              const dayHeader = document.createElement("div");
              dayHeader.className = "day-header";
              dayHeader.textContent = day;
              dayColumn.appendChild(dayHeader);

              const subjectsByName = {};
              days[day].forEach(entry => {
                if (!subjectsByName[entry.subject]) subjectsByName[entry.subject] = [];
                subjectsByName[entry.subject].push(entry);
              });

              for (const subject in subjectsByName) {
                const subjectBlock = document.createElement("div");
                subjectBlock.className = "subject-block";

                const subjectName = document.createElement("div");
                subjectName.className = "subject-name";
                subjectName.textContent = subject.toUpperCase();
                subjectBlock.appendChild(subjectName);

                const timeSlots = document.createElement("div");
                timeSlots.className = "time-slots";

                subjectsByName[subject].forEach(entry => {
                  const slot = document.createElement("div");
                  slot.className = "time-slot";
                  slot.textContent = `${entry.time} - ${entry.grade}`;
                  timeSlots.appendChild(slot);
                });

                subjectBlock.appendChild(timeSlots);
                dayColumn.appendChild(subjectBlock);
              }

              gridRow.appendChild(dayColumn);
            });

            container.appendChild(gridRow);
          }
        }
      } catch (err) {
        console.error("Failed to load timetable:", err);
        container.innerHTML = "<p>Error loading timetable.</p>";
      } finally {
        // Show timetable and footer only after loading
        container.style.display = "block";
        footer.style.display = "block";
      }
    }

    loadTimetable();
  </script>
</body>
</html>
