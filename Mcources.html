<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EduNova Admin Dashboard - Manage Courses</title>
<link rel="stylesheet" href="css/mcources.css">
</head>
<body>
<div class="container">
  <aside class="sidebar">
    <div class="logo"><h2>EduNova Admin</h2></div>
    <nav>
      <ul>
        <li><a href="#" class="nav-link" data-page="dashboard">ğŸ“Š Dashboard</a></li>
        <li><a href="#" class="nav-link" data-page="students">ğŸ‘¥ Manage Students</a></li>
        <li><a href="#" class="nav-link" data-page="teachers">ğŸ‘¨â€ğŸ« Manage Teachers</a></li>
        <li><a href="#" class="nav-link active" data-page="courses">ğŸ“š Manage Courses</a></li>
        <li><a href="#" class="nav-link" data-page="timetable">â° Manage Time Table</a></li>
        <li><a href="#" class="nav-link" data-page="settings">âš™ï¸ Settings</a></li>
        <li><a href="#" class="logout-btn">ğŸšª Logout</a></li>
      </ul>
    </nav>
  </aside>

  <main class="main-content">
    <header class="top-header">
      <div class="header-left">
        <img src="assets/logo.jpeg" alt="EduNova Logo" class="header-logo">
        <span class="company-name">EduNova</span>
      </div>
    </header>

    <div class="content">
      <h1>Manage Courses</h1>
      <p class="instructions">* Admins can upload materials to Google Drive and share the link here.</p>

      <div class="form-container">
        <div class="form-row">
          <div class="form-group">
            <label for="grade-select">Select Grade</label>
            <select id="grade-select" class="custom-select">
              <option value="">Choose Grade</option>
              <option value="Grade 6">Grade 6</option>
              <option value="Grade 7">Grade 7</option>
              <option value="Grade 8">Grade 8</option>
              <option value="Grade 9">Grade 9</option>
              <option value="Grade 10">Grade 10</option>
              <option value="Grade 11">Grade 11</option>
            </select>
          </div>

          <div class="form-group">
            <label for="subject-select">Select Subject</label>
            <select id="subject-select" class="custom-select">
              <option value="">Choose Subject</option>
              <option value="Mathematics">Mathematics</option>
              <option value="Science">Science</option>
              <option value="English">English</option>
              <option value="History">History</option>
              <option value="Sinhala">Sinhala</option>
              <option value="Buddhism">Buddhism</option>
            </select>
          </div>

          <div class="form-group">
            <label for="resource-type-select">Select Resource Type</label>
            <select id="resource-type-select" class="custom-select">
              <option value="">Choose Resource Type</option>
              <option value="Past Papers">Past Paper</option>
              <option value="Model Papers">Model Paper</option>
              <option value="Study Resources">Study Resource</option>
            </select>
          </div>

          <div class="form-group">
            <label for="year-select">Select Year</label>
            <select id="year-select" class="custom-select">
              <option value="">Choose year</option>
              <option value="2025">2025</option>
              <option value="2024">2024</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="2020">2020</option>
              <option value="2019">2019</option>
              <option value="2018">2018</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="google-drive-link">ğŸ“¤ Google Drive Link</label>
          <input type="url" id="google-drive-link" placeholder="https://drive.google.com/...">
        </div>

        <div class="button-group">
          <button class="btn btn-primary add-course-btn">Add Course</button>
          <button class="btn btn-secondary update-course-btn">Update Selected</button>
        </div>
      </div>

      <div class="status-message" id="statusMessage" style="display:none;"></div>

      <hr>

      <h2>All Courses</h2>
      <table id="coursesTable">
        <thead>
          <tr>
            <th>Grade</th>
            <th>Subject</th>
            <th>Type</th>
            <th>Year</th>
            <th>Link</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

    </div>
  </main>
</div>

<script>
const statusMessage = document.getElementById('statusMessage');
const coursesTableBody = document.querySelector('#coursesTable tbody');
let selectedCourseId = null;

async function fetchCourses() {
  const res = await fetch('http://localhost:5000/api/courses');
  const courses = await res.json();
  coursesTableBody.innerHTML = '';
  courses.forEach(course => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${course.grade}</td>
      <td>${course.subject}</td>
      <td>${course.resourceType}</td>
      <td>${course.year}</td>
      <td><a href="${course.link}" target="_blank">Open</a></td>
      <td>
        <button class="edit-btn" data-id="${course._id}">Edit</button>
        <button class="delete-btn" data-id="${course._id}">Delete</button>
      </td>
    `;
    coursesTableBody.appendChild(tr);
  });
}

// Add Course
document.querySelector('.add-course-btn').addEventListener('click', async () => {
  const grade = document.getElementById('grade-select').value;
  const subject = document.getElementById('subject-select').value;
  const resourceType = document.getElementById('resource-type-select').value;
  const year = document.getElementById('year-select').value; 
  const link = document.getElementById('google-drive-link').value;

  if(!grade || !subject || !resourceType || !year || !link){
    statusMessage.style.display = 'block';
    statusMessage.style.color = 'red';
    statusMessage.innerText = 'âš ï¸ Please fill all fields';
    return;
  }

  try {
    const res = await fetch('http://localhost:5000/api/courses', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({grade, subject, resourceType, year, link})
    });
    if(res.ok){
      statusMessage.style.display='block';
      statusMessage.style.color='green';
      statusMessage.innerText='âœ… Course added';
      fetchCourses();
      document.getElementById('grade-select').value = '';
      document.getElementById('subject-select').value = '';
      document.getElementById('resource-type-select').value = '';
      document.getElementById('year-select').value = '';
      document.getElementById('google-drive-link').value = '';
    }
  } catch(err){
    console.error(err);
  }
});

// Edit and Delete using Event Delegation
coursesTableBody.addEventListener('click', async (e) => {
  const id = e.target.dataset.id;
  if(e.target.classList.contains('delete-btn')){
    if(confirm('Are you sure you want to delete this course?')){
      await fetch(`http://localhost:5000/api/courses/${id}`, { method:'DELETE' });
      fetchCourses();
    }
  } else if(e.target.classList.contains('edit-btn')){
    selectedCourseId = id;
    const row = e.target.closest('tr');
    document.getElementById('grade-select').value = row.children[0].textContent;
    document.getElementById('subject-select').value = row.children[1].textContent;
    document.getElementById('resource-type-select').value = row.children[2].textContent;
    document.getElementById('year-select').value = row.children[3].textContent;
    document.getElementById('google-drive-link').value = row.children[4].querySelector('a').href;
  }
});

// Update Selected Course
document.querySelector('.update-course-btn').addEventListener('click', async () => {
  if(!selectedCourseId) return alert('Select a course to update first');
  const link = document.getElementById('google-drive-link').value;
  if(!link) return alert('Google Drive link cannot be empty');

  try {
    await fetch(`http://localhost:5000/api/courses/${selectedCourseId}`, {
      method:'PUT',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ link })
    });
    statusMessage.style.display='block';
    statusMessage.style.color='green';
    statusMessage.innerText='âœ… Course Updated';
    selectedCourseId = null;
    document.getElementById('google-drive-link').value = '';
    fetchCourses();
  } catch(err){
    console.error(err);
  }
});


fetchCourses();
</script>
</body>
</html>
